<!DOCTYPE html>
<html lang="en">
<head>
    <title>Transportation Budgets</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />

    <!--animation-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">

    <!--facebook and info icons-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!--use a better font for this web map-->
    <link href='http://fonts.googleapis.com/css?family=Goudy Old Style' rel='stylesheet' type='text/css'>


    <link rel="stylesheet" type="text/css" href="css/storymap.css">

    <!--add favicon for the web page-->
    <link rel="shortcut icon" href="../../img/favicon.ico" type="image/x-icon">
    <!--add required libraries-->
    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
    <script src="https://cdn.bootcss.com/chroma-js/1.3.3/chroma.min.js"></script>
    <script src="js/bouncemarker.js"></script>


    <!--story map plugin-->
    <script src="js/storymap.js"></script>

</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-6 col-md-4 main">
            <section data-scene="scene1">
                <h1>Legislative Policy and Reasearch Office</h1>
                <h2>Transportation Budgets by County</h2>
            </section>
            <section data-scene="scene2">
                <h1>Legislative Policy and Reasearch Office</h1>
            </section>
            <section data-scene="scene3">
                <h1>Legislative Policy and Reasearch Office</h1>
            </section>
            <section data-scene="scene4">
                <h1>Legislative Policy and Reasearch Office</h1>
                <p><a href="https://github.com/gka/chroma.js/wiki/Predefined-Colors" target="_blank">Predefined Colors</a></p>
            </section>
            <section data-scene="scene5">
                <h1>Legislative Policy and Reasearch Office</h1>
            </section>
        </div>
        <div id="map" class="col-sm-6 col-md-8 sidebar"></div>
    </div>
    <!--add a scrolling down arrow-->
    <div class="animated zoomIn infinite glyphicon glyphicon-menu-down arrow-down"></div>
    <!--add a navigation bar-->
    <div class="navbar text-center"></div>
</div>
<script type="text/javascript">
    //////////////////////////////////////////////////////////////////////////
    // Scene 1: Plain
    var counties_legend ='<i style="background: black; opacity: 0.5"></i><p><b>Counties</b></p>';
    var counties = L.geoJson.ajax('js/OR_CounBud.geojson',  {
        color: 'black',
        weight: 2,
        opacity: 0.3});
    //////////////////////////////////////////////////////////////////////////
    // Scene 2: Choropleth
    // Set function for color ramp
    function setColor(County_Trans_Buds_Budget){
        //condition ? valueIfTrue : valueIfFalse
        return  County_Trans_Buds_Budget > 13000000 ? '#006d2c' :
                County_Trans_Buds_Budget > 10000000 ? '#31a354' :
                County_Trans_Buds_Budget >  5000000 ? '#74c476' :
                County_Trans_Buds_Budget >  1000000 ? '#a1d99b' :
                County_Trans_Buds_Budget >   500000 ? '#c7e9c0' :
                                                      '#edf8e9' ;

    }
    // Set style function that sets fill color property equal to cell tower density
    function style(features) {
        return {
            fillColor: setColor(features.properties.County_Trans_Buds_Budget),
            fillOpacity: 0.5,
            weight: 2,
            opacity: 0.8,
            color: '#ffffff',
            dashArray: '4'
        };
    }
    var counties_choropleth = L.geoJson.ajax('js/OR_CounBud.geojson',
        {
            style: style,
            onEachFeature: function (feature, layer) {
                layer.bindTooltip(features.properties.County_Trans_Buds_Budget, {className: 'feature-label', permanent: false, direction: 'center'});
            }
        });
    var counties_choropleth_legend = '<p><b>County Budgets</b></p>' +
        '<i style="background: #edf8e9; opacity: 0.5"></i><p><b>0 - 49000</b></p>' +
        '<i style="background: #c7e9c0; opacity: 0.5"></i><p><b>50000- 499999</b></p>' +
        '<i style="background: #c7e9c0; opacity: 0.5"></i><p><b>500000- 999999</b></p>' +
        '<i style="background: #a1d99b; opacity: 0.5"></i><p><b>1000000 - 49999999</b></p>' +
        '<i style="background: #74c476; opacity: 0.5"></i><p><b>5000000 - 9999999</b></p>' +
        '<i style="background: #31a354; opacity: 0.5"></i><p><b>10000000 - 12999999</b></p>' +
        '<i style="background: #006d2c; opacity: 0.5"></i><p><b>13000000+</b></p>';
    //////////////////////////////////////////////////////////////////////////
    // Scene 3: Marker
    $('html > head').append($("<style> .marker-icon { color: red; font-size: 15px; text-shadow: 0 0 3px #ffffff;} </style>"));
    // $('html > head').append($("<style> .marker-icon { color: #0000ff; font-size: 15px; text-shadow:1px 1px 2px #ffffff, 0 0 25px rgba(0,0,255,0.75), 0 0 5px rgba(0,0,139,0.78);} </style>")); // glow effect: https://adventuresinmapping.com/2016/10/17/firefly-cartography/
    var towers = L.geoJson.ajax('js/OR_CitBud.geojson', {
        pointToLayer: function (feature, latlng) {
            delay = Math.floor((126 + latlng.lng) / 10 * 2000);
            //delay =Math.floor(Math.random() * 400);
            return L.marker(latlng, {bounceOnAdd: true,  bounceOnAddOptions: {duration: 200, height: window.innerHeight, delay:delay}, icon: L.divIcon({className: 'glyphicon glyphicon-signal marker-icon'})});
        },
        onEachFeature: function (feature, layer) {
            layer.bindTooltip(feature.properties.City_Trans_Buds_Budget, {sticky: true, className: "feature-tooltip"});
        }
    });
    var tower_legend ='<i class="glyphicon glyphicon-signal marker-icon"></i><p><b>Tower</b></p>';
    //////////////////////////////////////////////////////////////////////////
    // Scene 4: Marker categorized by an attribute
    var colors = chroma.scale('Set1').mode('lch').colors(10);
    for (i =1; i < 11; i++) {
        $('html > head').append($("<style> .marker-icon-" + i.toString() + " { color: " + colors[i] + "; font-size: 15px; text-shadow: 0 0 3px #ffffff;} </style>"));
    }
    var towers_color = L.geoJson.ajax('js/OR_HDist.geojson', {
        pointToLayer: function (feature, latlng) {
            if (feature.properties.company === "New Cingular") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-signal marker-icon-1'})});
            } else if (feature.properties.company === "Cellco") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-signal marker-icon-2'})});
            } else if (feature.properties.company === "RCC Minnesota") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-signal marker-icon-3'})});
            } else if (feature.properties.company === "Oregon RSA") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-signal marker-icon-4'})});
            } else if (feature.properties.company === "Verizon") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-signal marker-icon-5'})});
            } else if (feature.properties.company === "US Cellular") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-signal marker-icon-6'})});
            } else if (feature.properties.company === "Hood River Cellular") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-signal marker-icon-7'})});
            } else if (feature.properties.company === "Medford Cellular") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-signal marker-icon-8'})});
            } else if (feature.properties.company === "Salem Cullular") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-signal marker-icon-9'})});
            } else {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-signal marker-icon-10'})});
            }
        },
        onEachFeature: function (feature, layer) {
            layer.bindTooltip(feature.properties.Name, {sticky: true, className: "feature-tooltip"});
        }
    });
    var towers_color_legend = '<p><b>Tower Companies</b></p>'+
        '<i class="glyphicon glyphicon-signal marker-icon-1"></i><p>New Cingular</p>' +
        '<i class="glyphicon glyphicon-signal marker-icon-2"></i><p>Cellco</p>' +
        '<i class="glyphicon glyphicon-signal marker-icon-3"></i><p>RCC Minnesota</p>' +
        '<i class="glyphicon glyphicon-signal marker-icon-4"></i><p>Oregon RSA</p>' +
        '<i class="glyphicon glyphicon-signal marker-icon-5"></i><p>Verizon</p>' +
        '<i class="glyphicon glyphicon-signal marker-icon-6"></i><p>US Cellular</p>' +
        '<i class="glyphicon glyphicon-signal marker-icon-7"></i><p>Hood River Cell.</p>' +
        '<i class="glyphicon glyphicon-signal marker-icon-8"></i><p>Medford Cell.</p>' +
        '<i class="glyphicon glyphicon-signal marker-icon-9"></i><p>Salem Cullular</p>' +
        '<i class="glyphicon glyphicon-signal marker-icon-10"></i><p>Others</p>';
    //////////////////////////////////////////////////////////////////////////
    // Scene 5: circleMarker
    var towers_circle = L.geoJson.ajax('js/OR_SDist.geojson', {
        style: function (feature) {
            return {
                fillColor: chroma.random(),
                fillOpacity: 0.4,
                stroke: true,
                weight: 1,
                opacity: 0.8,
                color: '#ffffff'
            };
        },
        pointToLayer: function (feature, latlng) {
            //return L.circleMarker(latlng);
            return L.circle(latlng, 1000 * Math.pow(Math.floor((Math.random() * 3) + 1), 2));
        },
        onEachFeature: function (feature, layer) {
            layer.bindTooltip(feature.properties.Name, {sticky: true, className: "feature-tooltip"});
        }
    });
    var towers_circle_legend ='<i class=""><svg height="16" width="16"> <circle cx="8" cy="8" r="6" stroke="white" stroke-width="1" fill="red" fillOpacity="0.4" /> </svg></i><p><b>Tower</b></p>';
    //////////////////////////////////////////////////////////////////////////
    // Scene 6: circleMarker in glow effects
    var towers_circle2 = L.geoJson.ajax('../../assets/cell_towers.geojson', {
        pointToLayer: function (feature, latlng) {
            //return L.circle(latlng, 1000 * Math.pow(Math.floor((Math.random() * 3) + 1), 2));
            return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-one-fine-smaller-dot glow-effect'})});
        },
        onEachFeature: function (feature, layer) {
            layer.bindTooltip(feature.properties.Name, {sticky: true, className: "feature-tooltip"});
        }
    });
    var towers_circle2_legend ='<i class=""><svg height="16" width="16"> <circle cx="8" cy="8" r="6" stroke="white" stroke-width="0" fill="#00ff00" fillOpacity="0.4" /> </svg></i><p><b>Tower</b></p>';
    var darkLayer = L.tileLayer('http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png');
    //////////////////////////////////////////////////////////////////////////
    var layers = {
        'Counties': [counties, counties_legend],
        'counties_choropleth': [ counties_choropleth, counties_choropleth_legend],
        'House Districts': [towers, tower_legend],
        'towers_color': [towers_color, towers_color_legend],
        'towers_circle': [towers_circle, towers_circle_legend],
        'towers_circle2': [towers_circle2, towers_circle2_legend],
        'Senate Districts': [darkLayer]
    };
    var scenes = {
        scene1: {lat: 43.5709884, lng: -122.3770306, zoom: 6, name: 'County', layers: ['counties']},
        scene2: {lat: 44, lng: -123.5, zoom: 7, name: 'Choropleth', layers: ['counties_choropleth']},
        scene3: {lat: 44, lng: -123.5, zoom: 7, name: 'towers', layers: ['towers']},
        scene4: {lat: 44, lng: -123.5, zoom: 7, name: 'towers categorized by companies', layers: ['towers_color']},
        scene5: {lat: 44, lng: -123.5, zoom: 7, name: 'tower circles', layers: ['towers_circle']},
        scene6: {lat: 44, lng: -123.5, zoom: 7, name: 'tower circles', layers: ['towers_circle2', 'darkLayer']}
    };
    $('.main').storymap({
        scenes: scenes,
        layers: layers,
        legend: true, // if you do not want a legend feature, you can simply not define the createLegend function.
        scale: false,
        navbar: true,
        createMap: function () {
            // create a map in the "map" div, set the view to a given place and zoom
            var map = L.map('map');
            // add an base map, which can be either OSM, mapbox, tilelayer, wmslayer or those designed by yourself.
            L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 18,
                id: 'mapbox.satellite',
                detectRetina: true
            }).addTo(map);
            // hidden the credits, but show in the about page.
            $(".leaflet-control-attribution").css("display", "none");
            return map;
        }
    });
</script>
</body>
</html>